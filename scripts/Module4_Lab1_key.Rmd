---
title: "Tortoise Occupancy"
author: "Ellen Bledsoe"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# Desert Tortoise Occupancy
Analyze survey data for desert tortoises from Saguaro National Park

## Set-Up

I have installed the `unmarked` package for you already in RStudio Cloud. This is a new package we will be using to do our occupancy calculations.

We will need to first load the `tidyverse` and `unmarked`

```{r}
library(tidyverse)
library(unmarked) # Load the unmarked package
```

Now we need to read in our dataset, called `tortoise_occupancy.csv`

```{r}
tort_occ <- read_csv("data_raw/tortoise_occupancy.csv")
```

## Prepare Our Data

#### Explore the data
First, let's take a look at `tort_occ`, our tortoise occupancy data. What does each column represent? How about each row?
```{r}
head(tort_occ)
```

#### Create a time data frame
Establish the time of each survey occasion for each plot

```{r}
survey_time <- data.frame(time_1 = rep('1', 20),
                          time_2 = rep('2', 20),
                          time_3 = rep('3', 20),
                          time_4 = rep('4', 20),
                          time_5 = rep('5', 20))
survey_time <- list(time = survey_time)
```


#### Create `unmarked` data frame

Ignore the warning

```{r}
tortUMF <- unmarkedFrameOccu(tort_occ, obsCovs = survey_time)
head(tortUMF) # check out the data
```


## Fit Models for Occupancy 

```{r}
# unmarked function is "occu"
# Format is:  factors that affect detection probability follow the first ~
#             factors that affect occupancy follow the second ~

# Model p(.)psi(.) -- psi constant across sites, det prob constant over time

pdot_psidot  <- occu(~1 ~1, data = tortUMF)

# Model p(t)psi(.) -- psi constant across sites, det prob varies with time (survey occasion)

ptime_psidot <- occu(~time-1 ~1, data = tortUMF)
```
	
## Model Selection 
```{r}
# Assemble models into a list to compare their AIC values

models <- fitList(pdot_psidot  = pdot_psidot, 
                  ptime_psidot = ptime_psidot)
modSel(models)
```

## Estimates & 95% CIs for Occupancy (psi) and Detection Probability (p) 

```{r}
### For model:  psi(.)p(.)

plogis(coef(psidot_pdot))  # estimates of psi and p

plogis(confint(psidot_pdot, type = "state", level = 0.95)) # 95% CI for psi
plogis(confint(psidot_pdot, type = "det",   level = 0.95)) # 95% CI for p


### For model:  psi(.)p(t)

plogis(coef(psidot.ptime))

plogis(confint(psidot_ptime, type = "state", level = 0.95))
plogis(confint(psidot_ptime, type = "det",   level = 0.95))

```

## Naive Occupancy
```{r}
detects <- apply(tort_occ, 1, sum)  # Calculate the sum for every row in a vector
nSites <- length(detects)           # Total number of sites surveyed
no_detections <- sum(detects == 0)  # Number of sites with no detections
detections <- sum(detects > 0)      # Number of sites with at least one detection

(naive_occ <- detections/nSites)
```

